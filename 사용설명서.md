# sdfdesk 클라이언트 사용 설명서

## 개요

`sdfdesk`는 RustDesk 기반의 CLI(Command Line Interface) 원격 데스크톱 클라이언트입니다. 자동화 테스트와 스크립트를 통한 원격 접속을 위해 설계되었으며, GUI 없이 명령줄에서 직접 실행할 수 있습니다.

## 주요 기능

- **포트 포워딩**: 원격 호스트의 포트를 로컬 포트로 연결
- **연결 테스트**: 원격 호스트와의 연결 상태 확인
- **서버 모드**: sdfdesk를 서버로 실행하여 원격 접속 대기
- **비밀번호 설정**: 영구 비밀번호 설정 및 관리

## 설치 및 빌드

### 필수 요구사항

- Rust 개발 환경
- C++ 빌드 환경
- vcpkg 패키지 매니저

### 빌드 방법

```bash
# 저장소 클론
git clone https://github.com/rustdesk/rustdesk
cd rustdesk/sdfdesk

# 빌드
cargo build --release
```

빌드가 완료되면 `target/release/sdfdesk` 또는 `target/release/sdfdesk.exe`(Windows) 실행 파일이 생성됩니다.

## 사용 방법

### 기본 명령어

```bash
sdfdesk [옵션]
```

### 명령줄 옵션

#### 1. 포트 포워딩 (`-p`, `--port-forward`)

원격 호스트의 특정 포트를 로컬 포트로 연결합니다.

**형식:**
```bash
sdfdesk -p <원격ID>:<로컬포트>:<원격포트>[:<원격호스트>]
```

**예제:**
```bash
# 원격 ID가 123456789인 호스트의 3389 포트를 로컬 8080 포트로 연결
sdfdesk -p 123456789:8080:3389

# 원격 호스트 지정 (기본값: localhost)
sdfdesk -p 123456789:8080:3389:192.168.1.100

# 비밀번호와 함께 사용
sdfdesk -p 123456789:8080:3389 -k mypassword
```

**파라미터:**
- `원격ID`: 연결할 원격 호스트의 RustDesk ID
- `로컬포트`: 로컬에서 사용할 포트 번호
- `원격포트`: 원격 호스트에서 연결할 포트 번호
- `원격호스트`: (선택사항) 원격 호스트 주소 (기본값: localhost)

#### 2. 연결 테스트 (`-c`, `--connect`)

원격 호스트와의 연결을 테스트합니다.

**형식:**
```bash
sdfdesk -c <원격ID>
```

**예제:**
```bash
# 기본 연결 테스트
sdfdesk -c 123456789

# 비밀번호와 함께 연결 테스트
sdfdesk -c 123456789 -k mypassword
```

#### 3. 서버 모드 (`-s`, `--server`)

sdfdesk를 서버로 실행하여 다른 클라이언트의 연결을 대기합니다.

**형식:**
```bash
sdfdesk -s
```

**예제:**
```bash
# 서버 모드로 시작 (ID가 자동으로 출력됨)
sdfdesk -s
```

서버 모드로 실행하면 자동으로 고유한 ID가 생성되어 표시됩니다. 다른 클라이언트는 이 ID를 사용하여 연결할 수 있습니다.

#### 4. 비밀번호 설정 (`--password`)

영구 비밀번호를 설정합니다.

**형식:**
```bash
sdfdesk --password <비밀번호>
```

**예제:**
```bash
# 영구 비밀번호 설정
sdfdesk --password mySecurePassword123
```

설정된 비밀번호는 로컬 설정 파일에 저장되며, 이후 연결 시 자동으로 사용됩니다.

#### 5. 인증 키 지정 (`-k`, `--key`)

연결 시 사용할 인증 키(비밀번호)를 지정합니다.

**형식:**
```bash
sdfdesk [명령] -k <비밀번호>
```

**예제:**
```bash
# 포트 포워딩 시 비밀번호 지정
sdfdesk -p 123456789:8080:3389 -k mypassword

# 연결 테스트 시 비밀번호 지정
sdfdesk -c 123456789 -k mypassword
```

## 사용 시나리오

### 시나리오 1: 원격 데스크톱 포트 포워딩

Windows 원격 데스크톱(RDP) 포트(3389)를 로컬로 포워딩하여 연결:

```bash
# 1. 원격 호스트에서 서버 모드로 실행
sdfdesk -s
# 출력 예시: id=123456789

# 2. 로컬에서 포트 포워딩 설정
sdfdesk -p 123456789:3389:3389 -k mypassword

# 3. RDP 클라이언트로 localhost:3389에 연결
mstsc /v:localhost:3389
```

### 시나리오 2: SSH 포트 포워딩

원격 서버의 SSH 포트(22)를 로컬로 포워딩:

```bash
# 포트 포워딩 설정
sdfdesk -p 123456789:2222:22 -k mypassword

# SSH 클라이언트로 연결
ssh user@localhost -p 2222
```

### 시나리오 3: 웹 서비스 접근

원격 서버의 웹 서비스(80 또는 443)를 로컬로 포워딩:

```bash
# HTTP 포트 포워딩
sdfdesk -p 123456789:8080:80 -k mypassword

# 웹 브라우저에서 http://localhost:8080 접속
```

### 시나리오 4: 데이터베이스 연결

원격 MySQL/PostgreSQL 서버에 연결:

```bash
# MySQL 포트 포워딩
sdfdesk -p 123456789:3306:3306 -k mypassword

# 데이터베이스 클라이언트로 연결
mysql -h 127.0.0.1 -P 3306 -u user -p
```

## 비밀번호 관리

### 비밀번호 우선순위

sdfdesk는 다음 순서로 비밀번호를 확인합니다:

1. **명령줄 옵션** (`-k` 또는 `--key`)으로 지정된 비밀번호
2. **설정 파일**에 저장된 영구 비밀번호
3. **대화형 입력**: 위의 방법으로 비밀번호를 찾지 못한 경우 프롬프트에서 입력 요청

### 영구 비밀번호 설정

```bash
# 영구 비밀번호 설정
sdfdesk --password mySecurePassword123
```

영구 비밀번호를 설정하면 매번 비밀번호를 입력할 필요가 없습니다.

### 일회성 비밀번호 사용

```bash
# 특정 연결에만 사용할 비밀번호 지정
sdfdesk -p 123456789:8080:3389 -k temporaryPassword
```

## 로그 및 디버깅

기본적으로 `info` 레벨의 로그가 출력됩니다. 환경 변수를 설정하여 로그 레벨을 조정할 수 있습니다:

```bash
# Windows PowerShell
$env:RUST_LOG="debug"
sdfdesk -s

# Linux/macOS
RUST_LOG=debug sdfdesk -s
```

**로그 레벨:**
- `error`: 에러 메시지만 표시
- `warn`: 경고 및 에러 표시
- `info`: 일반 정보, 경고, 에러 표시 (기본값)
- `debug`: 디버그 정보 포함
- `trace`: 모든 상세 정보 표시

## 문제 해결

### 연결 실패

**증상:** 원격 호스트에 연결할 수 없음

**해결 방법:**
1. 원격 ID가 정확한지 확인
2. 네트워크 연결 상태 확인
3. 방화벽 설정 확인
4. 비밀번호가 올바른지 확인

```bash
# 연결 테스트로 확인
sdfdesk -c 123456789 -k mypassword
```

### 비밀번호 오류

**증상:** "re-input-password" 오류 메시지

**해결 방법:**
1. 올바른 비밀번호를 입력
2. 영구 비밀번호가 설정된 경우 재설정

```bash
# 비밀번호 재설정
sdfdesk --password newPassword
```

### 포트 충돌

**증상:** "Failed to listen on port" 오류

**해결 방법:**
- 사용하려는 로컬 포트가 이미 사용 중인지 확인
- 다른 포트 번호 사용

```bash
# Windows에서 포트 사용 확인
netstat -ano | findstr :8080

# Linux/macOS에서 포트 사용 확인
lsof -i :8080
```

### NAT 타입 문제

**증상:** 연결이 느리거나 불안정함

**해결 방법:**
- NAT 타입을 확인하고 필요시 릴레이 서버 사용
- 라우터의 UPnP 설정 확인
- 포트 포워딩 설정 확인

## 보안 고려사항

1. **강력한 비밀번호 사용**: 최소 12자 이상의 복잡한 비밀번호를 사용하세요
2. **비밀번호 보호**: 명령줄에 비밀번호를 직접 입력하면 프로세스 목록에 노출될 수 있으므로, 가능하면 영구 비밀번호를 설정하거나 대화형 입력을 사용하세요
3. **신뢰할 수 있는 네트워크**: 가능하면 VPN이나 신뢰할 수 있는 네트워크를 통해 연결하세요
4. **접근 제한**: 필요한 포트만 포워딩하고, 불필요한 서비스는 비활성화하세요

## 고급 사용

### 스크립트 자동화

Bash 스크립트 예제:

```bash
#!/bin/bash

# 설정
REMOTE_ID="123456789"
PASSWORD="mySecurePassword"
LOCAL_PORT=8080
REMOTE_PORT=80

# 포트 포워딩 시작
echo "Starting port forwarding..."
sdfdesk -p ${REMOTE_ID}:${LOCAL_PORT}:${REMOTE_PORT} -k ${PASSWORD}
```

PowerShell 스크립트 예제:

```powershell
# 설정
$RemoteID = "123456789"
$Password = "mySecurePassword"
$LocalPort = 8080
$RemotePort = 80

# 포트 포워딩 시작
Write-Host "Starting port forwarding..."
sdfdesk -p "${RemoteID}:${LocalPort}:${RemotePort}" -k $Password
```

### 다중 포트 포워딩

여러 포트를 동시에 포워딩하려면 여러 개의 sdfdesk 인스턴스를 실행하세요:

```bash
# 터미널 1: RDP 포트
sdfdesk -p 123456789:3389:3389 -k mypassword

# 터미널 2: SSH 포트
sdfdesk -p 123456789:2222:22 -k mypassword

# 터미널 3: HTTP 포트
sdfdesk -p 123456789:8080:80 -k mypassword
```

## 라이센스 및 기여

sdfdesk는 RustDesk 프로젝트를 기반으로 합니다. 자세한 내용은 [RustDesk GitHub 저장소](https://github.com/rustdesk/rustdesk)를 참조하세요.

## 참고 자료

- [RustDesk 공식 웹사이트](https://rustdesk.com)
- [RustDesk 문서](https://rustdesk.com/docs)
- [RustDesk GitHub](https://github.com/rustdesk/rustdesk)
- [RustDesk Server](https://github.com/rustdesk/rustdesk-server)

## 버전 정보

현재 버전을 확인하려면:

```bash
sdfdesk --version
```

## 지원

문제가 발생하거나 질문이 있으면 다음을 참조하세요:

- [GitHub Issues](https://github.com/rustdesk/rustdesk/issues)
- [Discord 커뮤니티](https://discord.gg/nDceKgxnkV)
- [Reddit](https://www.reddit.com/r/rustdesk)
